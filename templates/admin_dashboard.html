<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsyFind Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            margin: 0;
            display: flex;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #3a526b;
        }

        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.85rem;
            color: #bdc3c7;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 12px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #34495e;
            border-left-color: #3498db;
            color: white;
        }

        .nav-item.active {
            background: #34495e;
            border-left-color: #e74c3c;
            color: white;
        }

        .nav-item i {
            width: 20px;
            margin-right: 10px;
        }

        .nav-section {
            margin-top: 30px;
            padding: 0 20px;
        }

        .nav-section-title {
            font-size: 0.75rem;
            color: #95a5a6;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        /* Main Content Area */
        .main-container {
            flex: 1;
            margin-left: 250px;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Language Toggle */
        .language-toggle {
            display: flex;
            margin-right: 15px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .lang-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            color: white;
        }

        .lang-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .lang-btn.active {
            background: rgba(255,255,255,0.3);
            color: white;
            font-weight: 600;
        }

        .main-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-card.sessions i { color: #4facfe; }
        .stat-card.assessments i { color: #43e97b; }
        .stat-card.memory i { color: #fa709a; }
        .stat-card.uptime i { color: #feca57; }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .panel-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h3 {
            font-size: 1.2rem;
            color: #2c3e50;
        }

        .panel-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .session-item:last-child {
            border-bottom: none;
        }

        .session-info {
            flex: 1;
        }

        .session-id {
            font-family: monospace;
            font-size: 0.85rem;
            color: #666;
        }

        .session-meta {
            font-size: 0.8rem;
            color: #999;
            margin-top: 2px;
        }

        .session-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
        }

        .refresh-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            color: #666;
        }

        .lang-btn:hover {
            background: #f8f9fa;
        }

        .lang-btn.active {
            background: #667eea;
            color: white;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-online { background: #43e97b; }
        .status-warning { background: #feca57; }
        .status-error { background: #ff6b6b; }

        .analytics-chart {
            margin-top: 20px;
        }

        .chart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .chart-bar {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }

        .chart-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.5s ease;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 30px;
        }

        .content-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .log-entry {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #666;
            margin-right: 10px;
        }

        .log-type {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 10px;
            font-size: 0.75rem;
        }

        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .backup-item:last-child {
            border-bottom: none;
        }

        .backup-info h4 {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
        }

        .backup-meta {
            font-size: 0.8rem;
            color: #666;
        }

        .settings-group {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .settings-group h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Sidebar Toggle */
        .sidebar-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.active {
                display: block;
            }

            .main-container {
                margin-left: 0;
            }

            .sidebar-toggle {
                display: block;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-shield-alt"></i> PsyFind Admin</h2>
            <p>Administration Panel</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> <span data-lang="nav_dashboard">Dashboard</span>
            </a>
            <a href="#analytics" class="nav-item" onclick="showSection('analytics')">
                <i class="fas fa-chart-bar"></i> <span data-lang="nav_analytics">Analytics</span>
            </a>
            <a href="#sessions" class="nav-item" onclick="showSection('sessions')">
                <i class="fas fa-users"></i> <span data-lang="nav_sessions">Active Sessions</span>
            </a>
            <a href="#health" class="nav-item" onclick="showSection('health')">
                <i class="fas fa-heartbeat"></i> <span data-lang="nav_health">System Health</span>
            </a>
            
            <div class="nav-section">
                <div class="nav-section-title" data-lang="nav_management">Management</div>
                <a href="#assessments" class="nav-item" onclick="showSection('assessments')">
                    <i class="fas fa-clipboard-check"></i> <span data-lang="nav_assessments">Assessments</span>
                </a>
                <a href="#clinical" class="nav-item" onclick="showSection('clinical')">
                    <i class="fas fa-user-md"></i> <span data-lang="nav_clinical">Clinical Records</span>
                </a>
                <a href="#doctors" class="nav-item" onclick="showSection('doctors')">
                    <i class="fas fa-stethoscope"></i> <span data-lang="nav_doctors">Doctors</span>
                </a>
                <a href="#reports" class="nav-item" onclick="showSection('reports')">
                    <i class="fas fa-file-medical"></i> <span data-lang="nav_reports">Reports</span>
                </a>
                <a href="#settings" class="nav-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> <span data-lang="nav_settings">Settings</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title" data-lang="nav_system">System</div>
                <a href="#logs" class="nav-item" onclick="showSection('logs')">
                    <i class="fas fa-list-alt"></i> <span data-lang="nav_logs">System Logs</span>
                </a>
                <a href="#backup" class="nav-item" onclick="showSection('backup')">
                    <i class="fas fa-database"></i> <span data-lang="nav_backup">Backup</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="header">
            <div class="header-left">
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1><i class="fas fa-shield-alt"></i> <span data-lang="admin_title">PsyFind Admin</span></h1>
            </div>
            <div class="header-right">
                <div class="language-toggle">
                    <button class="lang-btn" onclick="switchAdminLanguage('en')" id="lang-en">EN</button>
                    <button class="lang-btn active" onclick="switchAdminLanguage('zh')" id="lang-zh">中文</button>
                </div>
                <span class="admin-info" data-lang="admin_panel">Admin Panel</span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> <span data-lang="logout">Logout</span>
                </button>
            </div>
        </div>

    <div class="main-content">
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card sessions">
                <i class="fas fa-users"></i>
                <div class="stat-value" id="activeSessions">-</div>
                <div class="stat-label" data-lang="active_sessions">Active Sessions</div>
            </div>
            <div class="stat-card assessments">
                <i class="fas fa-clipboard-check"></i>
                <div class="stat-value" id="totalAssessments">-</div>
                <div class="stat-label" data-lang="total_assessments">Total Assessments</div>
            </div>
            <div class="stat-card memory">
                <i class="fas fa-memory"></i>
                <div class="stat-value" id="memoryUsage">-</div>
                <div class="stat-label" data-lang="memory_usage">Memory Usage</div>
            </div>
            <div class="stat-card uptime">
                <i class="fas fa-clock"></i>
                <div class="stat-value" id="systemUptime">-</div>
                <div class="stat-label" data-lang="system_uptime">System Uptime</div>
            </div>
        </div>

        <!-- Dashboard Panels -->
        <div class="dashboard-grid">
            <!-- Active Sessions Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-users"></i> <span data-lang="active_sessions">Active Sessions</span></h3>
                    <button class="refresh-btn" onclick="refreshSessions()">
                        <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                    </button>
                </div>
                <div class="panel-content" id="sessionsPanel">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p data-lang="loading_sessions">Loading sessions...</p>
                    </div>
                </div>
            </div>

            <!-- System Health Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-heartbeat"></i> <span data-lang="system_health">System Health</span></h3>
                    <button class="refresh-btn" onclick="refreshHealth()">
                        <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                    </button>
                </div>
                <div class="panel-content" id="healthPanel">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p data-lang="loading_health_data">Loading health data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Panel -->
        <div class="panel">
            <div class="panel-header">
                <h3><i class="fas fa-chart-bar"></i> <span data-lang="assessment_analytics">Assessment Analytics</span></h3>
                <button class="refresh-btn" onclick="refreshAnalytics()">
                    <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                </button>
            </div>
            <div class="panel-content" id="analyticsPanel">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p data-lang="loading_analytics">Loading analytics...</p>
                </div>
            </div>
        </div>

        <!-- Assessment Analytics Section -->
        <div id="assessments-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-clipboard-check"></i> <span data-lang="assessment_analytics">Assessment Analytics</span></h2>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-chart-pie"></i> <span data-lang="assessment_distribution">Assessment Distribution</span></h3>
                        <button class="refresh-btn" onclick="refreshAssessments()">
                            <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                        </button>
                    </div>
                    <div class="panel-content" id="assessmentDistribution">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p data-lang="loading_assessment_data">Loading assessment data...</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-chart-line"></i> <span data-lang="recent_assessments">Recent Assessments</span></h3>
                    </div>
                    <div class="panel-content" id="recentAssessments">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p data-lang="loading_recent_assessments">Loading recent assessments...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Records Section -->
        <div id="clinical-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-user-md"></i> <span data-lang="clinical_records">Clinical Records</span></h2>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-users"></i> <span data-lang="clinical_sessions">Clinical Sessions</span></h3>
                        <button class="refresh-btn" onclick="refreshClinicalSessions()">
                            <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                        </button>
                    </div>
                    <div class="panel-content" id="clinicalSessions">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p data-lang="loading_clinical_sessions">Loading clinical sessions...</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-file-medical-alt"></i> <span data-lang="clinical_reports">Clinical Reports</span></h3>
                        <div>
                            <select id="clinicalReportType" style="margin-right: 10px; padding: 4px; border-radius: 4px; border: 1px solid #ddd;">
                                <option value="" data-lang="all_types">All Types</option>
                                <option value="phq9">PHQ-9</option>
                                <option value="gad7">GAD-7</option>
                                <option value="whiteley">Whiteley-7</option>
                            </select>
                            <button class="refresh-btn" onclick="refreshClinicalReports()">
                                <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content" id="clinicalReports">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p data-lang="loading_clinical_reports">Loading clinical reports...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Session Detail Modal -->
            <div id="sessionDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 15px; width: 90%; max-width: 1000px; max-height: 90%; overflow-y: auto;">
                    <div style="padding: 20px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                        <h3 id="modalSessionTitle">Session Details</h3>
                        <button onclick="closeSessionModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                    </div>
                    <div id="sessionDetailContent" style="padding: 20px;">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Loading session details...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Doctors Section -->
        <div id="doctors-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-stethoscope"></i> <span data-lang="doctor_management">Doctor Management</span></h2>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-users"></i> <span data-lang="all_doctors">All Doctors</span></h3>
                        <div>
                            <button class="refresh-btn" onclick="showAddDoctorModal()" style="margin-right: 10px;">
                                <i class="fas fa-plus"></i> <span data-lang="add_doctor">Add Doctor</span>
                            </button>
                            <button class="refresh-btn" onclick="refreshDoctors()">
                                <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                            </button>
                        </div>
                    </div>
                    <div class="panel-content" id="doctorsList">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Loading doctors...</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-search"></i> <span data-lang="search_doctors">Search Doctors</span></h3>
                    </div>
                    <div class="panel-content">
                        <div style="margin-bottom: 15px;">
                            <input type="text" id="doctorSearchQuery" data-lang-placeholder="search_by_name" placeholder="Search by name, specialty, or location..." 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                            <select id="doctorSpecialtyFilter" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="" data-lang="all_specialties">All Specialties</option>
                                <option value="Psychiatrist">Psychiatrist</option>
                                <option value="Clinical Psychologist">Clinical Psychologist</option>
                                <option value="Counseling Psychologist">Counseling Psychologist</option>
                                <option value="Child Psychiatrist">Child Psychiatrist</option>
                                <option value="Neuropsychiatrist">Neuropsychiatrist</option>
                            </select>
                        </div>
                        <button onclick="searchDoctors()" class="refresh-btn" style="width: 100%;">
                            <i class="fas fa-search"></i> <span data-lang="search">Search</span>
                        </button>
                        <div id="doctorSearchResults" style="margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Doctor Modal -->
        <div id="doctorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 15px; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto;">
                <div style="padding: 20px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                    <h3 id="doctorModalTitle">Add Doctor</h3>
                    <button onclick="closeDoctorModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <form id="doctorForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Name *</label>
                                <input type="text" id="doctorName" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Specialty *</label>
                                <select id="doctorSpecialty" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option value="">Select Specialty</option>
                                    <option value="Psychiatrist">Psychiatrist</option>
                                    <option value="Clinical Psychologist">Clinical Psychologist</option>
                                    <option value="Counseling Psychologist">Counseling Psychologist</option>
                                    <option value="Child Psychiatrist">Child Psychiatrist</option>
                                    <option value="Neuropsychiatrist">Neuropsychiatrist</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Subspecialty</label>
                            <input type="text" id="doctorSubspecialty" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Phone</label>
                                <input type="tel" id="doctorPhone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email</label>
                                <input type="email" id="doctorEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Location</label>
                            <input type="text" id="doctorLocation" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Languages *</label>
                            <input type="text" id="doctorLanguages" required placeholder="e.g., English, Chinese, Spanish" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #6c757d;">Separate multiple languages with commas</small>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Experience</label>
                                <input type="text" id="doctorExperience" placeholder="e.g., 10 years" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Consultation Fee</label>
                                <input type="text" id="doctorFee" placeholder="e.g., $150/session" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Approach</label>
                            <textarea id="doctorApproach" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Education</label>
                            <textarea id="doctorEducation" rows="2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Notes</label>
                            <textarea id="doctorNotes" rows="2" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeDoctorModal()" style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save Doctor</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-file-medical"></i> <span data-lang="system_reports">System Reports</span></h2>
            
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-file-export"></i> <span data-lang="generate_report">Generate Report</span></h3>
                </div>
                <div class="panel-content">
                    <div style="margin-bottom: 20px;">
                        <label data-lang="report_type">Report Type:</label>
                        <select id="reportType" style="margin: 10px; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="summary" data-lang="summary_report">Summary Report</option>
                            <option value="detailed" data-lang="detailed_report">Detailed Report</option>
                            <option value="performance" data-lang="performance_report">Performance Report</option>
                        </select>
                        
                        <label data-lang="date_range">Date Range:</label>
                        <select id="dateRange" style="margin: 10px; padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="7" data-lang="last_7_days">Last 7 days</option>
                            <option value="30" data-lang="last_30_days">Last 30 days</option>
                            <option value="90" data-lang="last_90_days">Last 90 days</option>
                        </select>
                        
                        <button onclick="generateReport()" class="refresh-btn">
                            <i class="fas fa-file-download"></i> <span data-lang="generate_report">Generate Report</span>
                        </button>
                    </div>
                    <div id="reportContent" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- System Logs Section -->
        <div id="logs-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-list-alt"></i> <span data-lang="nav_logs">System Logs</span></h2>
            
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-terminal"></i> <span data-lang="event_logs">Event Logs</span></h3>
                    <div>
                        <select id="logType" style="margin-right: 10px; padding: 4px; border-radius: 4px; border: 1px solid #ddd;">
                            <option value="" data-lang="all_events">All Events</option>
                            <option value="session_start" data-lang="session_start">Session Start</option>
                            <option value="backup_created" data-lang="backup_created">Backup Created</option>
                            <option value="settings_updated" data-lang="settings_updated">Settings Updated</option>
                        </select>
                        <button class="refresh-btn" onclick="refreshLogs()">
                            <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                        </button>
                    </div>
                </div>
                <div class="panel-content" id="systemLogs">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p data-lang="loading_system_logs">Loading system logs...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup Section -->
        <div id="backup-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-database"></i> <span data-lang="backup_management">Backup Management</span></h2>
            
            <div class="dashboard-grid">
                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-plus"></i> <span data-lang="create_backup">Create Backup</span></h3>
                    </div>
                    <div class="panel-content">
                        <p data-lang="backup_description">Create a backup of the current database:</p>
                        <button onclick="createBackup()" class="refresh-btn" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-save"></i> <span data-lang="create_backup_now">Create Backup Now</span>
                        </button>
                        <div id="backupStatus" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-history"></i> <span data-lang="available_backups">Available Backups</span></h3>
                        <button class="refresh-btn" onclick="refreshBackups()">
                            <i class="fas fa-sync"></i> <span data-lang="refresh">Refresh</span>
                        </button>
                    </div>
                    <div class="panel-content" id="backupList">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p data-lang="loading_backups">Loading backups...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="content-section" style="display: none;">
            <h2><i class="fas fa-cog"></i> <span data-lang="system_settings">System Settings</span></h2>
            
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-sliders-h"></i> <span data-lang="configuration">Configuration</span></h3>
                </div>
                <div class="panel-content" id="systemSettings">
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p data-lang="loading_settings">Loading settings...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div> <!-- Close main-container -->

    <script>
        // Sidebar functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function showSection(sectionName) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            event.target.classList.add('active');
            
            // Hide ALL sections - both content-section and dashboard elements
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Hide dashboard elements specifically
            const statsGrid = document.querySelector('.stats-grid');
            const dashboardGrid = document.querySelector('.dashboard-grid');
            const dashboardSection = document.getElementById('dashboard-section');
            
            if (statsGrid) statsGrid.style.display = 'none';
            if (dashboardGrid) dashboardGrid.style.display = 'none';
            if (dashboardSection) dashboardSection.style.display = 'none';
            
            // Hide any other dashboard panels
            document.querySelectorAll('.main-content > .panel').forEach(panel => {
                panel.style.display = 'none';
            });
            
            // Close sidebar on mobile after selection
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
            
            // Show ONLY the selected section and load its data
            switch(sectionName) {
                case 'dashboard':
                    // Show dashboard elements
                    if (statsGrid) statsGrid.style.display = 'grid';
                    if (dashboardGrid) dashboardGrid.style.display = 'grid';
                    if (dashboardSection) dashboardSection.style.display = 'block';
                    
                    // Show dashboard panels
                    document.querySelectorAll('.main-content > .panel').forEach(panel => {
                        panel.style.display = 'block';
                    });
                    
                    loadDashboard();
                    break;
                case 'analytics':
                    document.getElementById('analytics-section').style.display = 'block';
                    refreshAnalytics();
                    break;
                case 'sessions':
                    document.getElementById('sessions-section').style.display = 'block';
                    refreshSessions();
                    break;
                case 'health':
                    document.getElementById('health-section').style.display = 'block';
                    refreshHealth();
                    break;
                case 'assessments':
                    document.getElementById('assessments-section').style.display = 'block';
                    refreshAssessments();
                    break;
                case 'clinical':
                    document.getElementById('clinical-section').style.display = 'block';
                    refreshClinicalSessions();
                    refreshClinicalReports();
                    break;
                case 'doctors':
                    document.getElementById('doctors-section').style.display = 'block';
                    refreshDoctors();
                    break;
                case 'reports':
                    document.getElementById('reports-section').style.display = 'block';
                    break;
                case 'settings':
                    document.getElementById('settings-section').style.display = 'block';
                    refreshSettings();
                    break;
                case 'logs':
                    document.getElementById('logs-section').style.display = 'block';
                    refreshLogs();
                    break;
                case 'backup':
                    document.getElementById('backup-section').style.display = 'block';
                    refreshBackups();
                    break;
            }
        }

        // Assessment Analytics Functions
        async function refreshAssessments() {
            try {
                const response = await fetch('/admin/api/assessments/overview');
                const data = await response.json();
                
                if (response.ok) {
                    updateAssessmentDistribution(data.distribution);
                    updateRecentAssessments(data.recent_assessments);
                }
            } catch (error) {
                console.error('Failed to load assessment data:', error);
            }
        }

        function updateAssessmentDistribution(distribution) {
            const panel = document.getElementById('assessmentDistribution');
            
            if (distribution.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No assessment data available</p>';
                return;
            }
            
            let html = '<div class="analytics-chart">';
            distribution.forEach(item => {
                html += `
                    <div class="chart-item">
                        <span>${item.assessment_type.toUpperCase()} - ${item.severity}</span>
                        <div class="chart-bar">
                            <div class="chart-fill" style="width: ${(item.count / Math.max(...distribution.map(d => d.count))) * 100}%"></div>
                        </div>
                        <span>${item.count}</span>
                    </div>
                `;
            });
            html += '</div>';
            panel.innerHTML = html;
        }

        function updateRecentAssessments(assessments) {
            const panel = document.getElementById('recentAssessments');
            
            if (assessments.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No recent assessments</p>';
                return;
            }
            
            let html = '';
            assessments.slice(0, 10).forEach(assessment => {
                const date = new Date(assessment.created_at).toLocaleDateString();
                html += `
                    <div class="session-item">
                        <div class="session-info">
                            <div><strong>${assessment.assessment_type.toUpperCase()}</strong> - Score: ${assessment.score}</div>
                            <div class="session-meta">${assessment.severity} • ${date}</div>
                        </div>
                    </div>
                `;
            });
            panel.innerHTML = html;
        }

        // Reports Functions
        async function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            
            try {
                const response = await fetch('/admin/api/reports/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: reportType, date_range: parseInt(dateRange) })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displayReport(data);
                } else {
                    alert('Failed to generate report: ' + data.error);
                }
            } catch (error) {
                alert('Error generating report: ' + error.message);
            }
        }

        function displayReport(report) {
            const content = document.getElementById('reportContent');
            
            let html = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4>${report.report_type.charAt(0).toUpperCase() + report.report_type.slice(1)} Report</h4>
                    <p><strong>Generated:</strong> ${new Date(report.generated_at).toLocaleString()}</p>
                    <p><strong>Date Range:</strong> Last ${report.date_range_days} days</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${report.summary.total_sessions}</div>
                        <div style="font-size: 0.85rem; color: #666;">Total Sessions</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${report.summary.total_assessments}</div>
                        <div style="font-size: 0.85rem; color: #666;">Total Assessments</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${report.summary.active_sessions}</div>
                        <div style="font-size: 0.85rem; color: #666;">Active Sessions</div>
                    </div>
                </div>
            `;
            
            if (report.performance && report.performance.length > 0) {
                html += '<h5>Performance Metrics</h5><div class="analytics-chart">';
                report.performance.forEach(metric => {
                    html += `
                        <div class="chart-item">
                            <span>${metric.assessment_type.toUpperCase()}</span>
                            <span>Avg: ${metric.avg_score ? metric.avg_score.toFixed(1) : 'N/A'}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            content.innerHTML = html;
        }

        // System Logs Functions
        async function refreshLogs() {
            const logType = document.getElementById('logType').value;
            
            try {
                let url = '/admin/api/logs?limit=50';
                if (logType) {
                    url += `&type=${logType}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    displayLogs(data.logs);
                }
            } catch (error) {
                console.error('Failed to load logs:', error);
            }
        }

        function displayLogs(logs) {
            const panel = document.getElementById('systemLogs');
            
            if (logs.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No logs available</p>';
                return;
            }
            
            let html = '';
            logs.forEach(log => {
                const date = new Date(log.timestamp).toLocaleString();
                html += `
                    <div class="log-entry">
                        <span class="log-timestamp">${date}</span>
                        <span class="log-type">${log.event_type}</span>
                        <span>${JSON.stringify(log.event_data)}</span>
                    </div>
                `;
            });
            panel.innerHTML = html;
        }

        // Backup Functions
        async function createBackup() {
            try {
                const response = await fetch('/admin/api/backup/create', { method: 'POST' });
                const data = await response.json();
                
                const status = document.getElementById('backupStatus');
                if (response.ok) {
                    status.innerHTML = `<div style="color: green; padding: 10px; background: #e8f5e8; border-radius: 4px;">
                        ✓ Backup created successfully: ${data.backup_file}
                    </div>`;
                    refreshBackups();
                } else {
                    status.innerHTML = `<div style="color: red; padding: 10px; background: #fee; border-radius: 4px;">
                        ✗ Failed to create backup: ${data.error}
                    </div>`;
                }
            } catch (error) {
                document.getElementById('backupStatus').innerHTML = `<div style="color: red; padding: 10px; background: #fee; border-radius: 4px;">
                    ✗ Error: ${error.message}
                </div>`;
            }
        }

        async function refreshBackups() {
            try {
                const response = await fetch('/admin/api/backup/list');
                const data = await response.json();
                
                if (response.ok) {
                    displayBackups(data.backups);
                }
            } catch (error) {
                console.error('Failed to load backups:', error);
            }
        }

        function displayBackups(backups) {
            const panel = document.getElementById('backupList');
            
            if (backups.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No backups available</p>';
                return;
            }
            
            let html = '';
            backups.forEach(backup => {
                const date = new Date(backup.created_at).toLocaleString();
                const size = (backup.size / 1024 / 1024).toFixed(2);
                html += `
                    <div class="backup-item">
                        <div class="backup-info">
                            <h4>${backup.filename}</h4>
                            <div class="backup-meta">${size} MB • ${date}</div>
                        </div>
                    </div>
                `;
            });
            panel.innerHTML = html;
        }

        // Settings Functions
        async function refreshSettings() {
            try {
                const response = await fetch('/admin/api/settings');
                const data = await response.json();
                
                if (response.ok) {
                    displaySettings(data);
                }
            } catch (error) {
                console.error('Failed to load settings:', error);
            }
        }

        function displaySettings(settings) {
            const panel = document.getElementById('systemSettings');
            
            let html = `
                <div class="settings-group">
                    <h4>System Configuration</h4>
                    <div class="setting-item">
                        <span>LLM Provider</span>
                        <span>${settings.llm_provider}</span>
                    </div>
                    <div class="setting-item">
                        <span>Debug Mode</span>
                        <span>${settings.debug_mode ? 'Enabled' : 'Disabled'}</span>
                    </div>
                    <div class="setting-item">
                        <span>Session Timeout</span>
                        <span>${settings.session_timeout / 60} minutes</span>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>System Information</h4>
                    <div class="setting-item">
                        <span>Python Version</span>
                        <span>${settings.system_info.python_version}</span>
                    </div>
                    <div class="setting-item">
                        <span>Database Path</span>
                        <span>${settings.system_info.database_path}</span>
                    </div>
                    <div class="setting-item">
                        <span>Uptime</span>
                        <span>${Math.floor(settings.system_info.uptime / 3600)} hours</span>
                    </div>
                </div>
            `;
            
            panel.innerHTML = html;
        }

        // Clinical Records Functions
        async function refreshClinicalSessions() {
            try {
                const response = await fetch('/admin/api/clinical/sessions?limit=50');
                const data = await response.json();
                
                if (response.ok) {
                    displayClinicalSessions(data.sessions);
                }
            } catch (error) {
                console.error('Failed to load clinical sessions:', error);
            }
        }

        function displayClinicalSessions(sessions) {
            const panel = document.getElementById('clinicalSessions');
            
            if (sessions.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No clinical sessions available</p>';
                return;
            }
            
            let html = '';
            sessions.forEach(session => {
                const date = new Date(session.last_activity).toLocaleString();
                const sessionId = session.session_id.substring(0, 16) + '...';
                html += `
                    <div class="session-item" style="cursor: pointer;" onclick="viewSessionDetails('${session.session_id}')">
                        <div class="session-info">
                            <div><strong>Session:</strong> ${sessionId}</div>
                            <div class="session-meta">
                                ${session.language} • ${session.actual_message_count} messages • ${session.assessment_count} assessments
                            </div>
                            <div class="session-meta">${date} • Stage: ${session.conversation_stage}</div>
                        </div>
                        <div class="session-actions">
                            <button class="btn-small" style="background: #4facfe; color: white;" onclick="event.stopPropagation(); exportClinicalData('${session.session_id}')">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                `;
            });
            panel.innerHTML = html;
        }

        async function refreshClinicalReports() {
            const reportType = document.getElementById('clinicalReportType').value;
            
            try {
                let url = '/admin/api/clinical/reports?limit=30';
                if (reportType) {
                    url += `&type=${reportType}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    displayClinicalReports(data.reports);
                }
            } catch (error) {
                console.error('Failed to load clinical reports:', error);
            }
        }

        function displayClinicalReports(reports) {
            const panel = document.getElementById('clinicalReports');
            
            if (reports.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No clinical reports available</p>';
                return;
            }
            
            let html = '';
            reports.forEach(report => {
                const date = new Date(report.created_at).toLocaleDateString();
                const sessionId = report.session_id.substring(0, 16) + '...';
                html += `
                    <div class="session-item" style="cursor: pointer;" onclick="viewSessionDetails('${report.session_id}')">
                        <div class="session-info">
                            <div><strong>${report.assessment_type.toUpperCase()}</strong> - Score: ${report.score}</div>
                            <div class="session-meta">${report.severity} • ${date} • Session: ${sessionId}</div>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                ${report.clinical_report.substring(0, 150)}...
                            </div>
                        </div>
                    </div>
                `;
            });
            panel.innerHTML = html;
        }

        async function viewSessionDetails(sessionId) {
            const modal = document.getElementById('sessionDetailModal');
            const content = document.getElementById('sessionDetailContent');
            const title = document.getElementById('modalSessionTitle');
            
            // Show modal with loading
            modal.style.display = 'block';
            title.textContent = `Session Details: ${sessionId.substring(0, 16)}...`;
            content.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading session details...</p>
                </div>
            `;
            
            try {
                const response = await fetch(`/admin/api/clinical/session/${sessionId}`);
                const data = await response.json();
                
                if (response.ok) {
                    displaySessionDetails(data);
                } else {
                    content.innerHTML = `<p style="color: red;">Error loading session: ${data.error}</p>`;
                }
            } catch (error) {
                content.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        function displaySessionDetails(data) {
            const content = document.getElementById('sessionDetailContent');
            
            let html = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 10px; background: #e3f2fd; border-radius: 8px;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${data.total_messages}</div>
                        <div style="font-size: 0.85rem; color: #666;">Total Messages</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${data.total_assessments}</div>
                        <div style="font-size: 0.85rem; color: #666;">Assessments</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <div style="font-size: 1.2rem; font-weight: bold;">${data.session_info.language}</div>
                        <div style="font-size: 0.85rem; color: #666;">Language</div>
                    </div>
                </div>
            `;
            
            // Chat History
            if (data.chat_history.length > 0) {
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px;"><i class="fas fa-comments"></i> Complete Chat History</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px;">
                `;
                
                data.chat_history.forEach(msg => {
                    const time = new Date(msg.timestamp).toLocaleString();
                    const roleClass = msg.role === 'user' ? 'background: #e3f2fd;' : 'background: #f8f9fa;';
                    html += `
                        <div style="margin-bottom: 15px; padding: 10px; border-radius: 8px; ${roleClass}">
                            <div style="font-weight: bold; margin-bottom: 5px;">
                                ${msg.role.charAt(0).toUpperCase() + msg.role.slice(1)} - ${time}
                            </div>
                            <div>${msg.content}</div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // Assessment Results with Unredacted Reports
            if (data.assessments.length > 0) {
                html += `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-bottom: 15px;"><i class="fas fa-file-medical"></i> Clinical Reports (Unredacted)</h4>
                `;
                
                data.assessments.forEach(assessment => {
                    const date = new Date(assessment.created_at).toLocaleDateString();
                    html += `
                        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h5>${assessment.assessment_type.toUpperCase()} Assessment</h5>
                                <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                    Score: ${assessment.score} | ${assessment.severity} | ${date}
                                </span>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-family: 'Segoe UI', sans-serif; line-height: 1.6;">
                                ${assessment.clinical_report}
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            content.innerHTML = html;
        }

        function closeSessionModal() {
            document.getElementById('sessionDetailModal').style.display = 'none';
        }

        async function exportClinicalData(sessionId) {
            try {
                const response = await fetch(`/admin/api/clinical/export/${sessionId}`);
                const data = await response.json();
                
                if (response.ok) {
                    // Create downloadable file
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `clinical_export_${sessionId.substring(0, 16)}_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    alert('Clinical data exported successfully!');
                } else {
                    alert('Failed to export clinical data: ' + data.error);
                }
            } catch (error) {
                alert('Error exporting clinical data: ' + error.message);
            }
        }

        let refreshInterval;

        // Admin Language Support
        let currentAdminLanguage = 'zh'; // Default to Chinese

        const adminTranslations = {
            'zh': {
                'admin_title': 'PsyFind 管理後台',
                'admin_panel': '管理面板',
                'logout': '登出',
                'nav_dashboard': '儀表板',
                'nav_analytics': '分析',
                'nav_sessions': '活躍會話',
                'nav_health': '系統健康',
                'nav_management': '管理',
                'nav_assessments': '評估',
                'nav_clinical': '臨床記錄',
                'nav_doctors': '醫生',
                'nav_reports': '報告',
                'nav_settings': '設定',
                'nav_system': '系統',
                'nav_logs': '系統日誌',
                'nav_backup': '備份',
                'active_sessions': '活躍會話',
                'total_assessments': '總評估數',
                'system_health': '系統健康',
                'database_status': '資料庫狀態',
                'memory_usage': '記憶體使用',
                'system_uptime': '系統運行時間',
                'add_doctor': '新增醫生',
                'refresh': '刷新',
                'search_doctors': '搜尋醫生',
                'all_doctors': '所有醫生',
                'search': '搜尋',
                'name': '姓名',
                'specialty': '專科',
                'phone': '電話',
                'email': '電子郵件',
                'location': '地點',
                'languages': '語言',
                'experience': '經驗',
                'consultation_fee': '諮詢費用',
                'save_doctor': '保存醫生',
                'cancel': '取消',
                'edit': '編輯',
                'delete': '刪除',
                'no_doctors_found': '未找到醫生',
                'doctor_management': '醫生管理',
                'loading_doctors': '載入醫生中...',
                'loading_sessions': '載入會話中...',
                'all_specialties': '所有專科',
                'search_by_name': '按姓名、專科或地點搜尋...',
                'assessment_analytics': '評估分析',
                'assessment_distribution': '評估分佈',
                'recent_assessments': '最近評估',
                'loading_assessment_data': '載入評估數據中...',
                'loading_recent_assessments': '載入最近評估中...',
                'clinical_records': '臨床記錄',
                'clinical_sessions': '臨床會話',
                'clinical_reports': '臨床報告',
                'loading_clinical_sessions': '載入臨床會話中...',
                'loading_clinical_reports': '載入臨床報告中...',
                'all_types': '所有類型',
                'loading_health_data': '載入健康數據中...',
                'loading_analytics': '載入分析中...',
                'event_logs': '事件日誌',
                'all_events': '所有事件',
                'session_start': '會話開始',
                'backup_created': '備份已建立',
                'settings_updated': '設定已更新',
                'loading_system_logs': '載入系統日誌中...',
                'backup_management': '備份管理',
                'create_backup': '建立備份',
                'backup_description': '建立當前資料庫的備份：',
                'create_backup_now': '立即建立備份',
                'available_backups': '可用備份',
                'loading_backups': '載入備份中...',
                'system_settings': '系統設定',
                'configuration': '配置',
                'loading_settings': '載入設定中...',
                'system_reports': '系統報告',
                'generate_report': '生成報告',
                'report_type': '報告類型：',
                'summary_report': '摘要報告',
                'detailed_report': '詳細報告',
                'performance_report': '性能報告',
                'date_range': '日期範圍：',
                'last_7_days': '最近7天',
                'last_30_days': '最近30天',
                'last_90_days': '最近90天'
            },
            'en': {
                'admin_title': 'PsyFind Admin',
                'admin_panel': 'Admin Panel',
                'logout': 'Logout',
                'nav_dashboard': 'Dashboard',
                'nav_analytics': 'Analytics',
                'nav_sessions': 'Active Sessions',
                'nav_health': 'System Health',
                'nav_management': 'Management',
                'nav_assessments': 'Assessments',
                'nav_clinical': 'Clinical Records',
                'nav_doctors': 'Doctors',
                'nav_reports': 'Reports',
                'nav_settings': 'Settings',
                'nav_system': 'System',
                'nav_logs': 'System Logs',
                'nav_backup': 'Backup',
                'active_sessions': 'Active Sessions',
                'total_assessments': 'Total Assessments',
                'system_health': 'System Health',
                'database_status': 'Database Status',
                'memory_usage': 'Memory Usage',
                'system_uptime': 'System Uptime',
                'add_doctor': 'Add Doctor',
                'refresh': 'Refresh',
                'search_doctors': 'Search Doctors',
                'all_doctors': 'All Doctors',
                'search': 'Search',
                'name': 'Name',
                'specialty': 'Specialty',
                'phone': 'Phone',
                'email': 'Email',
                'location': 'Location',
                'languages': 'Languages',
                'experience': 'Experience',
                'consultation_fee': 'Consultation Fee',
                'save_doctor': 'Save Doctor',
                'cancel': 'Cancel',
                'edit': 'Edit',
                'delete': 'Delete',
                'no_doctors_found': 'No doctors found',
                'doctor_management': 'Doctor Management',
                'loading_doctors': 'Loading doctors...',
                'loading_sessions': 'Loading sessions...',
                'all_specialties': 'All Specialties',
                'search_by_name': 'Search by name, specialty, or location...',
                'assessment_analytics': 'Assessment Analytics',
                'assessment_distribution': 'Assessment Distribution',
                'recent_assessments': 'Recent Assessments',
                'loading_assessment_data': 'Loading assessment data...',
                'loading_recent_assessments': 'Loading recent assessments...',
                'clinical_records': 'Clinical Records',
                'clinical_sessions': 'Clinical Sessions',
                'clinical_reports': 'Clinical Reports',
                'loading_clinical_sessions': 'Loading clinical sessions...',
                'loading_clinical_reports': 'Loading clinical reports...',
                'all_types': 'All Types',
                'loading_health_data': 'Loading health data...',
                'loading_analytics': 'Loading analytics...',
                'event_logs': 'Event Logs',
                'all_events': 'All Events',
                'session_start': 'Session Start',
                'backup_created': 'Backup Created',
                'settings_updated': 'Settings Updated',
                'loading_system_logs': 'Loading system logs...',
                'backup_management': 'Backup Management',
                'create_backup': 'Create Backup',
                'backup_description': 'Create a backup of the current database:',
                'create_backup_now': 'Create Backup Now',
                'available_backups': 'Available Backups',
                'loading_backups': 'Loading backups...',
                'system_settings': 'System Settings',
                'configuration': 'Configuration',
                'loading_settings': 'Loading settings...',
                'system_reports': 'System Reports',
                'generate_report': 'Generate Report',
                'report_type': 'Report Type:',
                'summary_report': 'Summary Report',
                'detailed_report': 'Detailed Report',
                'performance_report': 'Performance Report',
                'date_range': 'Date Range:',
                'last_7_days': 'Last 7 days',
                'last_30_days': 'Last 30 days',
                'last_90_days': 'Last 90 days'
            }
        };

        function switchAdminLanguage(lang) {
            currentAdminLanguage = lang;
            
            // Update language button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Update all text elements
            updateAdminLanguageDisplay();
            
            // Save preference
            localStorage.setItem('adminLanguage', lang);
        }

        function updateAdminLanguageDisplay() {
            const translations = adminTranslations[currentAdminLanguage];
            
            // Update text content
            document.querySelectorAll('[data-lang]').forEach(element => {
                const key = element.getAttribute('data-lang');
                if (translations[key]) {
                    element.textContent = translations[key];
                }
            });
            
            // Update placeholders
            document.querySelectorAll('[data-lang-placeholder]').forEach(element => {
                const key = element.getAttribute('data-lang-placeholder');
                if (translations[key]) {
                    element.placeholder = translations[key];
                }
            });
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved language preference
            const savedLang = localStorage.getItem('adminLanguage') || 'zh';
            switchAdminLanguage(savedLang);
            
            loadDashboard();
            
            // Auto-refresh every 30 seconds
            refreshInterval = setInterval(loadDashboard, 30000);
        });

        async function loadDashboard() {
            await Promise.all([
                refreshAnalytics(),
                refreshSessions(),
                refreshHealth()
            ]);
        }

        async function refreshAnalytics() {
            try {
                const response = await fetch('/admin/api/analytics');
                const data = await response.json();
                
                if (response.ok) {
                    updateStatsCards(data);
                    updateAnalyticsPanel(data);
                }
            } catch (error) {
                console.error('Failed to load analytics:', error);
            }
        }

        async function refreshSessions() {
            try {
                const response = await fetch('/admin/api/sessions');
                const data = await response.json();
                
                if (response.ok) {
                    updateSessionsPanel(data.sessions);
                }
            } catch (error) {
                console.error('Failed to load sessions:', error);
            }
        }

        async function refreshHealth() {
            try {
                const response = await fetch('/admin/api/system/health');
                const data = await response.json();
                
                if (response.ok) {
                    updateHealthPanel(data);
                }
            } catch (error) {
                console.error('Failed to load health data:', error);
            }
        }

        function updateStatsCards(data) {
            document.getElementById('activeSessions').textContent = data.active_sessions || 0;
            document.getElementById('totalAssessments').textContent = data.total_assessments || 0;
            document.getElementById('memoryUsage').textContent = 
                data.system_health?.memory_usage ? `${data.system_health.memory_usage.toFixed(1)}%` : 'N/A';
            
            // Calculate uptime
            if (data.system_health?.uptime) {
                const uptime = new Date(data.system_health.uptime);
                const now = new Date();
                const diffHours = Math.floor((now - uptime) / (1000 * 60 * 60));
                document.getElementById('systemUptime').textContent = `${diffHours}h`;
            }
        }

        function updateSessionsPanel(sessions) {
            const panel = document.getElementById('sessionsPanel');
            
            if (sessions.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No active sessions</p>';
                return;
            }
            
            panel.innerHTML = sessions.map(session => `
                <div class="session-item">
                    <div class="session-info">
                        <div class="session-id">${session.session_id}</div>
                        <div class="session-meta">
                            ${session.language} • ${session.message_count} messages • ${session.conversation_stage}
                        </div>
                    </div>
                    <div class="session-actions">
                        <button class="btn-small btn-danger" onclick="terminateSession('${session.session_id}')">
                            <i class="fas fa-times"></i> End
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateHealthPanel(data) {
            const panel = document.getElementById('healthPanel');
            
            const getStatusClass = (status) => {
                if (status === 'openai_ready' || status === 'ollama_ready') return 'status-online';
                if (status === 'fallback_mode') return 'status-warning';
                return 'status-error';
            };
            
            const getStatusText = (status) => {
                switch(status) {
                    case 'openai_ready': return 'OpenAI Ready';
                    case 'ollama_ready': return 'Ollama Ready';
                    case 'fallback_mode': return 'Fallback Mode';
                    default: return 'Error';
                }
            };
            
            panel.innerHTML = `
                <div class="system-status">
                    <div class="status-indicator ${getStatusClass(data.llm_status)}"></div>
                    <strong>LLM Status:</strong> ${getStatusText(data.llm_status)}
                </div>
                <div class="system-status">
                    <div class="status-indicator status-online"></div>
                    <strong>Memory Usage:</strong> ${data.memory_usage?.toFixed(1) || 'N/A'}%
                </div>
                <div class="system-status">
                    <div class="status-indicator status-online"></div>
                    <strong>Active Sessions:</strong> ${data.active_sessions || 0}
                </div>
                <div class="system-status">
                    <div class="status-indicator status-online"></div>
                    <strong>Total Sessions:</strong> ${data.total_sessions || 0}
                </div>
                <div style="margin-top: 20px;">
                    <button class="refresh-btn" onclick="cleanupSessions()" style="width: 100%;">
                        <i class="fas fa-broom"></i> Cleanup Expired Sessions
                    </button>
                </div>
            `;
        }

        function updateAnalyticsPanel(data) {
            const panel = document.getElementById('analyticsPanel');
            const assessmentTypes = data.assessment_types || {};
            const total = Object.values(assessmentTypes).reduce((sum, count) => sum + count, 0);
            
            if (total === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No assessment data available</p>';
                return;
            }
            
            panel.innerHTML = `
                <h4 style="margin-bottom: 15px;">Assessment Types</h4>
                <div class="analytics-chart">
                    ${Object.entries(assessmentTypes).map(([type, count]) => `
                        <div class="chart-item">
                            <span>${type.toUpperCase()}</span>
                            <div class="chart-bar">
                                <div class="chart-fill" style="width: ${(count / total) * 100}%"></div>
                            </div>
                            <span>${count}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function terminateSession(sessionId) {
            if (!confirm('Are you sure you want to terminate this session?')) return;
            
            try {
                const response = await fetch(`/admin/api/sessions/${sessionId}/terminate`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    refreshSessions();
                    refreshAnalytics();
                } else {
                    alert('Failed to terminate session');
                }
            } catch (error) {
                alert('Error terminating session');
            }
        }

        async function cleanupSessions() {
            try {
                const response = await fetch('/admin/api/system/cleanup', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert(`Cleaned up ${data.cleaned_sessions} expired sessions`);
                    refreshSessions();
                    refreshAnalytics();
                } else {
                    alert('Failed to cleanup sessions');
                }
            } catch (error) {
                alert('Error during cleanup');
            }
        }

        async function logout() {
            try {
                const response = await fetch('/admin/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    window.location.href = '/admin/login';
                }
            } catch (error) {
                window.location.href = '/admin/login';
            }
        }

        // Cleanup interval on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });

        // Doctor Management Functions
        let currentDoctorId = null;

        async function refreshDoctors() {
            try {
                const response = await fetch('/admin/api/doctors');
                const data = await response.json();
                displayDoctors(data.doctors);
            } catch (error) {
                console.error('Error fetching doctors:', error);
                document.getElementById('doctorsList').innerHTML = '<p style="color: red;">Error loading doctors</p>';
            }
        }

        function displayDoctors(doctors) {
            const panel = document.getElementById('doctorsList');
            
            if (doctors.length === 0) {
                panel.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No doctors found</p>';
                return;
            }
            
            panel.innerHTML = doctors.map(doctor => `
                <div class="doctor-item" style="border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: #2c3e50;">${doctor.name}</h4>
                            <p style="margin: 0 0 5px 0; color: #667eea; font-weight: 600;">${doctor.specialty}</p>
                            ${doctor.subspecialty ? `<p style="margin: 0 0 5px 0; color: #6c757d; font-size: 0.9rem;">${doctor.subspecialty}</p>` : ''}
                            <div style="display: flex; gap: 15px; margin-top: 8px; font-size: 0.85rem; color: #6c757d;">
                                ${doctor.location ? `<span><i class="fas fa-map-marker-alt"></i> ${doctor.location}</span>` : ''}
                                ${doctor.phone ? `<span><i class="fas fa-phone"></i> ${doctor.phone}</span>` : ''}
                                ${doctor.experience ? `<span><i class="fas fa-graduation-cap"></i> ${doctor.experience}</span>` : ''}
                            </div>
                            <div style="margin-top: 5px;">
                                <span style="font-size: 0.85rem; color: #6c757d;">
                                    <i class="fas fa-language"></i> ${doctor.languages.join(', ')}
                                </span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editDoctor(${doctor.id})" class="btn-small" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteDoctor(${doctor.id}, '${doctor.name}')" class="btn-small" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showAddDoctorModal() {
            currentDoctorId = null;
            document.getElementById('doctorModalTitle').textContent = 'Add Doctor';
            document.getElementById('doctorForm').reset();
            document.getElementById('doctorModal').style.display = 'block';
        }

        async function editDoctor(doctorId) {
            try {
                const response = await fetch(`/admin/api/doctors/${doctorId}`);
                const data = await response.json();
                
                if (data.doctor) {
                    currentDoctorId = doctorId;
                    document.getElementById('doctorModalTitle').textContent = 'Edit Doctor';
                    
                    // Populate form fields
                    document.getElementById('doctorName').value = data.doctor.name || '';
                    document.getElementById('doctorSpecialty').value = data.doctor.specialty || '';
                    document.getElementById('doctorSubspecialty').value = data.doctor.subspecialty || '';
                    document.getElementById('doctorPhone').value = data.doctor.phone || '';
                    document.getElementById('doctorEmail').value = data.doctor.email || '';
                    document.getElementById('doctorLocation').value = data.doctor.location || '';
                    document.getElementById('doctorLanguages').value = data.doctor.languages.join(', ') || '';
                    document.getElementById('doctorExperience').value = data.doctor.experience || '';
                    document.getElementById('doctorFee').value = data.doctor.consultation_fee || '';
                    document.getElementById('doctorApproach').value = data.doctor.approach || '';
                    document.getElementById('doctorEducation').value = data.doctor.education || '';
                    document.getElementById('doctorNotes').value = data.doctor.notes || '';
                    
                    document.getElementById('doctorModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error fetching doctor:', error);
                alert('Error loading doctor details');
            }
        }

        async function deleteDoctor(doctorId, doctorName) {
            if (!confirm(`Are you sure you want to delete Dr. ${doctorName}?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/api/doctors/${doctorId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Doctor deleted successfully');
                    refreshDoctors();
                } else {
                    alert('Error deleting doctor');
                }
            } catch (error) {
                console.error('Error deleting doctor:', error);
                alert('Error deleting doctor');
            }
        }

        function closeDoctorModal() {
            document.getElementById('doctorModal').style.display = 'none';
            currentDoctorId = null;
        }

        async function searchDoctors() {
            const query = document.getElementById('doctorSearchQuery').value.trim();
            const specialty = document.getElementById('doctorSpecialtyFilter').value;
            
            if (!query) {
                document.getElementById('doctorSearchResults').innerHTML = '<p style="color: #666;">Please enter a search query</p>';
                return;
            }
            
            try {
                const params = new URLSearchParams({ q: query });
                if (specialty) params.append('specialty', specialty);
                
                const response = await fetch(`/admin/api/doctors/search?${params}`);
                const data = await response.json();
                
                const resultsDiv = document.getElementById('doctorSearchResults');
                if (data.doctors.length === 0) {
                    resultsDiv.innerHTML = '<p style="color: #666;">No doctors found</p>';
                } else {
                    resultsDiv.innerHTML = `
                        <h4>Search Results (${data.doctors.length})</h4>
                        ${data.doctors.map(doctor => `
                            <div style="border: 1px solid #e9ecef; border-radius: 4px; padding: 10px; margin-bottom: 8px;">
                                <strong>${doctor.name}</strong> - ${doctor.specialty}
                                ${doctor.location ? `<br><small><i class="fas fa-map-marker-alt"></i> ${doctor.location}</small>` : ''}
                            </div>
                        `).join('')}
                    `;
                }
            } catch (error) {
                console.error('Error searching doctors:', error);
                document.getElementById('doctorSearchResults').innerHTML = '<p style="color: red;">Error searching doctors</p>';
            }
        }

        // Doctor form submission
        document.getElementById('doctorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('doctorName').value,
                specialty: document.getElementById('doctorSpecialty').value,
                subspecialty: document.getElementById('doctorSubspecialty').value,
                phone: document.getElementById('doctorPhone').value,
                email: document.getElementById('doctorEmail').value,
                location: document.getElementById('doctorLocation').value,
                languages: document.getElementById('doctorLanguages').value.split(',').map(lang => lang.trim()),
                experience: document.getElementById('doctorExperience').value,
                consultation_fee: document.getElementById('doctorFee').value,
                approach: document.getElementById('doctorApproach').value,
                education: document.getElementById('doctorEducation').value,
                notes: document.getElementById('doctorNotes').value
            };
            
            try {
                const url = currentDoctorId ? `/admin/api/doctors/${currentDoctorId}` : '/admin/api/doctors';
                const method = currentDoctorId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    alert(currentDoctorId ? 'Doctor updated successfully' : 'Doctor added successfully');
                    closeDoctorModal();
                    refreshDoctors();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving doctor:', error);
                alert('Error saving doctor');
            }
        });

    </script>
</body>
</html>
